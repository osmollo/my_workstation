---

- when: linux_distribution in ['ubuntu', 'debian']
  block:
    - name: "[MULLVAD_VPN] [DEB] download asc file"
      get_url:
        url: https://repository.mullvad.net/deb/mullvad-keyring.asc
        dest: /etc/apt/sources.list.d/mullvad.list
        owner: root
        group: root

    - name: "[MULLVAD_VPN] [DEB] download repo file"
      copy:
        source: |
          deb [signed-by=/usr/share/keyrings/mullvad-keyring.asc arch=$( dpkg --print-architecture )] https://repository.mullvad.net/deb/stable $(lsb_release -cs) main
        dest: /etc/apt/sources.list.d/mullvad.list
        owner: root
        group: root

    - name: "[MULLVAD_VPN] [DEB] install Mullvad VPN"
      apt:
        name: mullvad-vpn
        state: present
        update_cache: true

- when: linux_distribution == 'fedora'
  block:
    - name: "[MULLVAD_VPN] [FEDORA] download fedora repo"
      get_url:
        url: https://repository.mullvad.net/rpm/stable/mullvad.repo
        dest: "/etc/yum.repos.d/mullvad.repo"
        owner: root
        group: root

    - name: "[MULLVAD_VPN] [FEDORA] install Mullvad VPN"
      dnf:
        name: mullvad-vpn
        state: present
        update_cache: true

---

- name: "[OHMYBASH] Download installation script"
  get_url:
    url: "{{ ohmybash_installer }}"
    dest: /tmp/install.sh
    mode: 0755
    timeout: 60

- name: "[OHMYBASH] replace repository"
  replace:
    path: /tmp/install.sh
    regexp: 'ohmybash/oh-my-bash'
    replace: 'osmollo/oh-my-bash'
  when: from_post_install | default(false)

- name: "[OHMYBASH] check if previous oh-my-bash exists"
  stat:
    path: "{{ ansible_env.HOME }}/.oh-my-bash"
  register: ohmybashdir_exists

- name: "[OHMYBASH] Install oh-my-bash"
  become: false
  become_user: "{{ ansible_user }}"
  environment:
    REPO: "{{ 'osmollo/ohmyzsh' if from_post_install | default(false) else 'ohmyzsh/ohmyzsh' }}"
  command: bash -c "/tmp/install.sh --unattended"
  when: not ohmybashdir_exists.stat.exists

- name: "[OHMYBASH] replace source repo"
  git_config:
    repo: '{{ ansible_user_dir }}/.oh-my-bash'
    scope: 'local'
    name: 'remote.origin.url'
    value: 'https://github.com/ohmybash/oh-my-bash.git'
  when: from_post_install | default(false)

- name: "[OHMYBASH] delete temporal file"
  file:
    path: /tmp/install.sh
    state: absent
